#!/usr/bin/env tsx
import { writeFileSync } from 'node:fs'
import { dirname, resolve } from 'node:path'
import { fileURLToPath } from 'node:url'

const __filename = fileURLToPath(import.meta.url)
const __dirname = dirname(__filename)

/**
 * Icon generation script for @meldui/tabler-vue
 *
 * This script:
 * 1. Imports all icons from @tabler/icons-vue
 * 2. Generates re-exports that wrap each icon with createIcon()
 * 3. Writes the result to src/index.ts
 *
 * Run this script whenever @tabler/icons-vue is updated to sync new icons.
 *
 * Usage: pnpm generate-icons
 */

async function generateIcons() {
  console.log('üîÑ Generating icon re-exports...')

  // Import all Tabler icons
  const tablerIcons = await import('@tabler/icons-vue')

  // Get all icon names (exports starting with 'Icon')
  const iconNames = Object.keys(tablerIcons).filter(
    (name) => name.startsWith('Icon') && name !== 'Icon',
  )

  console.log(`üì¶ Found ${iconNames.length} icons from @tabler/icons-vue`)

  // Generate import statements with aliases to avoid conflicts
  const imports = iconNames.map((name) => `  ${name} as ${name}Original,`).join('\n')

  // Generate re-exports with wrapper
  const exports = iconNames
    .map((name) => `export const ${name} = createIcon(${name}Original)`)
    .join('\n')

  // Build the complete file content
  const fileContent = `/**
 * Auto-generated icon exports for @meldui/tabler-vue
 *
 * DO NOT EDIT THIS FILE MANUALLY!
 * Generated by: pnpm generate-icons
 * Generated on: ${new Date().toISOString()}
 *
 * This file re-exports all Tabler icons with MeldUI defaults applied.
 * Icons are wrapped using createIcon() to provide consistent sizing,
 * stroke width, and theme integration.
 */

import { createIcon } from './wrapper'
import {
${imports}
} from '@tabler/icons-vue'

// Re-export all icons with MeldUI defaults
${exports}

// Re-export utilities
export { createIcon } from './wrapper'
export { ICON_DEFAULTS } from './defaults'
export type { IconDefaults } from './defaults'
`

  // Write to src/index.ts
  const outputPath = resolve(__dirname, '../src/index.ts')
  writeFileSync(outputPath, fileContent, 'utf-8')

  console.log(`‚úÖ Generated ${iconNames.length} icon exports`)
  console.log(`üìù Written to: src/index.ts`)
}

// Run the generator
generateIcons().catch(console.error)
